<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1"
  />

  <title>Workout Log</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link
    rel="preconnect"
    href="https://fonts.gstatic.com"
    crossorigin
  >
  <link
    href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  >
  <link rel="stylesheet" href="style.css" />

  <!-- DOMPurify to prevent XSS when rendering notes / API text -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.3.0/dist/purify.min.js"></script>
</head>

<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="app-title-block">
        <h1>Workout Log</h1>
        <p>Track your sessions, moods, and progress over time.</p>
      </div>

      <section id="status" class="status-pill">
        <p id="readyStatus">✅ MongoDB connected</p>
        <p id="notReadyStatus">❌ MongoDB not connected. Check your connection string in <code>.env</code>.</p>
      </section>
    </header>

    <main class="app-main">
      <!-- LEFT COLUMN: controls + summary -->
      <aside class="sidebar">
        <div class="panel panel-highlight">
          <h2>Log a Workout</h2>
          <p class="panel-helper">Capture the essentials of each session in a few seconds.</p>
          <button
            id="createButton"
            class="primary-btn full-width"
            popovertarget="formPopover"
          >
            + New Workout
          </button>
        </div>

        <div class="panel">
          <h3>Filter Workouts</h3>
          <div class="filter-group">
            <label for="filterType">Workout Type</label>
            <select id="filterType">
              <option value="all">All Types</option>
              <option value="Upper Body">Upper Body</option>
              <option value="Lower Body">Lower Body</option>
              <option value="Cardio">Cardio</option>
              <option value="Full Body">Full Body</option>
            </select>
          </div>

          <div class="filter-group">
            <label for="filterMood">Mood Change</label>
            <select id="filterMood">
              <option value="all">Any</option>
              <option value="positive">Improved after workout</option>
              <option value="neutral">Stayed about the same</option>
              <option value="negative">Felt worse after</option>
            </select>
          </div>

          <button id="clearFilters" class="secondary-btn full-width">Clear Filters</button>
        </div>

        <section class="panel panel-subdued" id="summaryPanel">
          <h3>Workout Snapshot</h3>
          <ul class="summary-list">
            <li><span>Total Workouts:</span> <strong id="summaryCount">–</strong></li>
            <li><span>Avg. Duration:</span> <strong id="summaryDuration">–</strong></li>
            <li><span>Avg. Mood Change:</span> <strong id="summaryMood">–</strong></li>
          </ul>
        </section>
      </aside>

      <!-- MIDDLE COLUMN: workouts -->
      <section class="content-column">
        <div class="content-header">
          <div>
            <h2>Recent Workouts</h2>
            <p class="content-subtitle">Newest sessions appear at the top.</p>
          </div>
        </div>

        <section id="contentArea" class="workout-grid">
      
        </section>
      </section>

      <section class="exercise-column">
        <div class="panel panel-subdued">
          <h3>Exercise Explorer</h3>
          <p class="panel-helper">
            Search an exercise by name to see type, muscle, difficulty, and instructions.
          </p>

          <div class="exercise-search-row">
            <input
              type="text"
              id="exerciseSearchInput"
              placeholder="e.g. lat pulldown, glute kickback, preacher curl"
              autocomplete="off"
            />
            <button id="exerciseSearchBtn" class="secondary-btn">Search</button>
          </div>

          <p id="exerciseSearchStatus" class="exercise-status"></p>

          <ul id="exerciseResultsList" class="exercise-results">
          </ul>

          <div id="exerciseDetails" class="exercise-details">
            <p class="exercise-placeholder">
              No exercise selected yet. Try searching for something like
              <strong>lat pulldown</strong> or <strong>glute kickback</strong>.
            </p>
          </div>
        </div>
      </section>
    </main>

    <footer class="app-footer">
      Created for Systems Design in the Interaction Design program at Sheridan College.
    </footer>
  </div>

  <!-- POPOVER FORM -->
  <div id="formPopover" popover>
    <div class="form-shell">
      <header class="form-header">
        <h2>Log a Workout</h2>
        <p>Track how you moved and felt.</p>
      </header>

      <form id="myForm">
        <!-- Hidden field to store ID for updates -->
        <input type="hidden" name="id" id="id" />

        <div class="form-grid">
          <fieldset>
            <label for="date">Date<span class="required">*</span></label>
            <input
              required
              type="date"
              name="date"
              id="date"
              autocomplete="off"
            />
            <small class="validation">Date is required</small>
          </fieldset>

          <fieldset>
            <label for="workoutName">Exercise Name</label>
            <small class="hint">e.g. Lat Pulldown, Glute Kickback, Preacher Curl</small>
            <input
              type="text"
              name="workoutName"
              id="workoutName"
              placeholder="e.g. Tricep Pushdown"
            />
          </fieldset>

          <fieldset>
            <label for="workoutType">Workout Type</label>
            <select name="workoutType" id="workoutType">
              <option value="" disabled selected>Select a Workout Type</option>
              <option value="Upper Body">Upper Body</option>
              <option value="Lower Body">Lower Body</option>
              <option value="Cardio">Cardio</option>
              <option value="Full Body">Full Body</option>
            </select>
          </fieldset>

          <fieldset>
            <label for="minuteDuration">Duration (minutes)<span class="required">*</span></label>
            <input
              type="number"
              name="minuteDuration"
              id="minuteDuration"
              min="0"
              placeholder="e.g. 45"
              required
            />
          </fieldset>

          <fieldset>
            <label for="sets">Sets</label>
            <input
              type="number"
              name="sets"
              id="sets"
              min="0"
              placeholder="e.g. 3"
            />
          </fieldset>

          <fieldset>
            <label for="reps">Repetitions</label>
            <input
              type="number"
              name="reps"
              id="reps"
              min="0"
              placeholder="e.g. 12"
            />
          </fieldset>

          <fieldset>
            <label for="moodBefore">Mood Before</label>
            <small class="hint">1 = low · 5 = high</small>
            <input
              type="number"
              name="moodBefore"
              id="moodBefore"
              min="1"
              max="5"
            />
          </fieldset>

          <fieldset>
            <label for="moodAfter">Mood After</label>
            <small class="hint">1 = low · 5 = high</small>
            <input
              type="number"
              name="moodAfter"
              id="moodAfter"
              min="1"
              max="5"
            />
          </fieldset>

          <fieldset class="notes-field">
            <label for="notes">Notes</label>
            <small class="hint">Anything you want to remember about this session.</small>
            <textarea
              rows="4"
              name="notes"
              id="notes"
              placeholder="e.g. Felt strong today; increase weight next time."
            ></textarea>
          </fieldset>
        </div>

        <fieldset class="form-actions">
          <button class="save primary-btn" type="submit">Save Workout</button>
          <button
            class="cancel secondary-btn"
            type="button"
            popovertarget="formPopover"
            popovertargetaction="hide"
          >
            Cancel
          </button>
        </fieldset>
      </form>
    </div>
  </div>

  <script src="script.js" type="module"></script>
</body>
</html>
